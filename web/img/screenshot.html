<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        /*@font-face {*/
        /*font-family: xindixiaowanzi;*/
        /*src: url('xiaowanzi.ttf');*/
        /*}*/

        /*span {*/
        /*font-family: xindixiaowanzi;*/
        /*}*/

        .container {
            position: relative;
            width: 500px;
            height: 400px;
            /*background-color: red;*/
        }

        .item {
            position: absolute;
            width: 350px;
            height: 200px;
            background-image: url(http://omsjcq80n.bkt.clouddn.com/2ca4a08fff12f787c6e7398f38888d04.png);
        }

        .txt {
            position: absolute;
            top: 3px;
            left: 3px;
            font-family: bruce;
        }

        svg {
            position: absolute;
            top: 0;
            left: 0;
        }
    </style>

    <script src="../third-party/jquery-2.1.4.js"></script>
    <script src="html2canvas.js"></script>
    <!--<script src="html2canvas.svg.js"></script>-->
    <script>
        function getBase64ByUrl(src, callback) {
            var img = new Image(),
                canvas = document.createElement('canvas'),
                ctx = canvas.getContext('2d');

            img.crossOrigin = 'Anonymous';

            img.onload = function () {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);

                callback(canvas.toDataURL());
            };

            img.src = src;
        }

        function print() {

            getBase64ByUrl($('.item').css('background-image').replace('url("', '').replace('")', ''), function (data) {
                $('.item').css('background-image', `url("${data}")`);

                html2canvas(
                    document.getElementById('container'),
                    {
                        onrendered: function (canvas) {
                            // window.open(canvas.toDataURL("image/png"))
                            var imgSrc = canvas.toDataURL();

                            console.log(imgSrc);

//                        document.getElementById('outputImg').src = imgSrc;

                            $('#outputImg').attr('src', imgSrc);

                        }
                    }
                );
            });
        }

        getBase64ByUrl('http://omsjcq80n.bkt.clouddn.com/2ca4a08fff12f787c6e7398f38888d04.png', function (data) {
            console.log('base64 data')
//            console.log(data)
        })


        function addFontFace(family, uri) {
            /**
             * @param family {string} 字体名称
             * @param uri {string} 字体资源路径
             *
             * 注意：引用外部字体有跨域限制问题，除非远端开启了允许跨域访问
             */
            var strFontFace = '@font-face {font-family: "' + family + '"; src: url("' + uri + '");}';
            var styleNode = document.createElement('style');
            var textNode = document.createTextNode(strFontFace);

            styleNode.appendChild(textNode);
            document.head.appendChild(styleNode);
        }

        function addFont() {
            addFontFace('bruce', 'http://omsjcq80n.bkt.clouddn.com/huakanghaibao.woff2');

//            addFontFace('bruce', 'http://canvas.qq.com/font/%E5%8D%8E%E5%BA%B7%E6%B5%B7%E6%8A%A5%E4%BD%93W12.woff2');
        }

        console.log('hello')
    </script>
</head>
<body>
<div crossOrigin="anonymous" id="container" class="container">
    <div class="item"></div>
    <!--<img crossOrigin="anonymous" src="http://omsjcq80n.bkt.clouddn.com/2ca4a08fff12f787c6e7398f38888d04.png" alt="">-->
    <span class="txt">你好啊</span>
    <div style="width: 300px;height: 300px;position: absolute;z-index: 3;top: 0;left: 0">
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="306" height="296" id="svg2">
            <defs id="defs4"/>
            <g transform="translate(-162.46995,-477.2863)" id="layer1">
                <path d="m 314.15745,481.69558 c -59.20089,0.53774 -114.80979,36.72219 -137.3125,95.34375 -29.39129,76.56693 8.83932,162.45246 85.40625,191.84375 l 34.03125,-88.6875 c -20.0678,-7.71358 -34.3125,-27.15324 -34.3125,-49.9375 0,-29.54723 23.95277,-53.5 53.5,-53.5 29.54723,0 53.5,23.95277 53.5,53.5 0,22.78426 -14.2447,42.22392 -34.3125,49.9375 l 34.03125,88.6875 c 39.29085,-15.08234 70.3239,-46.1154 85.40625,-85.40625 29.39129,-76.56693 -8.83932,-162.48371 -85.40625,-191.875 -17.94537,-6.88859 -36.40853,-10.07087 -54.53125,-9.90625 z"
                      id="path2830"
                      style="fill:#40aa54;fill-opacity:1;stroke:#20552a;stroke-width:7.99999952;stroke-miterlimit:4;stroke-opacity:1;stroke-dasharray:none"/>
            </g>
        </svg>
    </div>
    <div style="width: 100px;height: 100px;position: absolute;z-index: 3;top: 0;left: 0">
        <svg version="1.0" id="svg1" width="300" height="300" viewBox="0 0 396.9 283.5">
            <path id="XMLID_2_" d="M327.7,88.2c-1.3-2.3-4.2,0-8.2-6.8c-2.3-4-9.6-3.5-9.8-5.3c-0.4-4.2,0.3-14.8-2.9-14.8
	c-3.2,0-6.8,7.1-8.2,10.6c-1.4,3.5-3.7,3.4-6.8,5.5c-6.5,4.3-10.5,16.5-9.1,23.1c-1.8,3.5-8.4,13.3-19.3,15.8s-19,19.6-23.6,29.8
	s-1.4,36.8-0.4,41.7c0.5,2.5,0.1,5.8-0.3,8.9c-15.3,28.2,14.9,46.2,48.9,33.8c14.4-5.2,6.5-7.5-6.6-4.8
	c-14.1,2.9-43.4-0.3-36.7-18.9c6.7,1.4,17.2,0.9,20,1c6.2,0.2,26.7,1.3,30.6-1.3c3.6-8.3-6-8.1-10.3-8.5c2.9-1.4,5.4-6.3,5.4-9.3
	c3.8,8.5,7.4,21.7,20,16.7c3.5-1.4,1.4-4.9,1.4-4.9s2.8-0.4,2.8-3.9c0-3.2-7.4-1.4-8.1-4.2s-0.4-27.7-0.4-31.2s0.7-9.6,7.9-18.9
	c8.7-11.4,1.7-34.1,2.4-37.1c0.7-3.3,6.3-4.2,9.2-8.4C327.6,94,328.7,90.1,327.7,88.2z"/>
            <path d="M217.4,123.3c-2,6.8-7,11.3-11.2,10.1c-4.3-1.2-6.1-7.7-4.2-14.5c2-6.8,7-11.3,11.2-10.1
	C217.5,110,219.4,116.5,217.4,123.3z M187.4,107.6c-4.4,0.7-7,6.9-5.9,13.9c1.1,7,5.6,12.1,9.9,11.4c4.4-0.7,7-6.9,5.9-13.9
	C196.3,112,191.8,106.9,187.4,107.6z M170.8,126.8c-4.1,1.6-5.4,7.7-3.1,13.6c2.4,5.9,7.6,9.4,11.6,7.8c4.1-1.6,5.4-7.7,3.1-13.6
	C180,128.7,174.8,125.2,170.8,126.8z M226.5,131.2c-4-1.7-9.3,1.6-11.8,7.5s-1.3,12,2.7,13.7s9.3-1.6,11.8-7.5
	S230.5,132.9,226.5,131.2z M217,167.9c5-5.3-8.6-27-18.5-27.4c-10.4-0.5-26.1,22.9-20.7,28.3c5.4,5.4,15.3,0.9,20.7,0
	C203.9,167.9,209.3,176,217,167.9z"/>
        </svg>
    </div>
</div>
<div>
    <input type="button" value="print" onclick="print()">
    <input type="button" value="add font" onclick="addFont()">
</div>
<div>
    <img id="outputImg" src="" alt="">
</div>
</body>
</html>